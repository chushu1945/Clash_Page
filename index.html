<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clash 组合工坊</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Noto+Serif+SC:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="background">
    <span class="orb orb-1"></span>
    <span class="orb orb-2"></span>
    <span class="orb orb-3"></span>
  </div>

  <main class="page">
    <header class="hero">
      <div class="hero-text">
        <span class="tag">本地运行 · 不上传</span>
        <h1>Clash 组合工坊</h1>
        <p>把节点链接转成 YAML，再一键生成 Mihomo 分流配置。清爽、优雅、步骤清晰。</p>
        <div class="hero-actions">
          <a class="btn primary" href="#converter">开始转换</a>
          <a class="btn ghost" href="#builder">生成配置</a>
        </div>
        <div class="hero-pills">
          <span class="pill">安全离线</span>
          <span class="pill accent">支持 ghfast 前缀</span>
          <span class="pill soft">双步骤更清晰</span>
        </div>
      </div>
      <div class="hero-stats">
        <div class="stat">
          <span>规则总数</span>
          <strong id="ruleCount">0</strong>
        </div>
        <div class="stat">
          <span>已选择</span>
          <strong id="ruleSelected">0</strong>
        </div>
        <div class="stat">
          <span>节点数</span>
          <strong id="nodeCount">0</strong>
        </div>
      </div>
    </header>

    <section class="module" id="converter">
      <div class="module-head">
        <div>
          <span class="eyebrow">Step 01</span>
          <h2>节点链接转换</h2>
          <p>粘贴 vmess / vless / ss / hysteria 等链接，一键生成可直接放入配置的 proxies 区块。</p>
        </div>
        <div class="module-badges">
          <span>支持 vmess / vless / trojan / ss</span>
          <span>hy2 / tuic / anytls / socks / http</span>
        </div>
      </div>

      <div class="split">
        <div class="card">
          <h3>输入</h3>
          <p class="meta">一行一个链接，支持注释行。</p>
          <textarea id="input" placeholder="vmess://...
vless://...
ss://..."></textarea>
          <div class="actions">
            <button class="btn primary" id="convert">转换</button>
            <button class="btn ghost" id="clear">清空</button>
          </div>
        </div>

        <div class="card">
          <h3>输出</h3>
          <p class="meta">复制到配置的 proxies 段落中。</p>
          <textarea id="output" readonly placeholder="YAML output will appear here."></textarea>
          <div class="actions">
            <button class="btn primary" id="copy">复制输出</button>
            <button class="btn soft" id="example">加载示例</button>
            <button class="btn accent" id="toConfig">加入分流配置</button>
          </div>
          <div class="alert" id="errors">暂无错误。</div>
        </div>
      </div>
    </section>

    <section class="module" id="builder">
      <div class="module-head">
        <div>
          <span class="eyebrow">Step 02</span>
          <h2>Mihomo 分流配置工坊</h2>
          <p>选择规则、调整代理组与参数，生成可直接使用的完整配置。</p>
        </div>
        <div class="module-badges">
          <span>本地生成 · 不上传</span>
          <span>规则库：blackmatrix7</span>
        </div>
      </div>

      <div class="builder-grid">
        <section class="panel">
          <h3>基础配置</h3>
          <div class="form-grid">
            <label>
              <span>配置文件名</span>
              <input id="configName" type="text" value="mihomo-config" />
            </label>
            <label>
              <span>Mixed Port</span>
              <input id="mixedPort" type="number" value="7890" min="1" max="65535" />
            </label>
            <label class="inline">
              <input id="allowLan" type="checkbox" />
              <span>允许局域网访问</span>
            </label>
            <label>
              <span>模式</span>
              <select id="mode">
                <option value="rule" selected>规则模式</option>
                <option value="global">全局</option>
                <option value="direct">直连</option>
              </select>
            </label>
            <label>
              <span>日志等级</span>
              <select id="logLevel">
                <option value="info">info</option>
                <option value="warning" selected>warning</option>
                <option value="error">error</option>
                <option value="silent">silent</option>
              </select>
            </label>
            <label class="inline">
              <input id="ipv6" type="checkbox" checked />
              <span>启用 IPv6</span>
            </label>
          </div>

          <div class="divider"></div>

          <h4>代理组</h4>
          <div class="form-grid">
            <label>
              <span>主代理组名</span>
              <input id="mainGroupName" type="text" value="Proxy" />
            </label>
            <label>
              <span>自动测速组名</span>
              <input id="autoGroupName" type="text" value="Auto" />
            </label>
            <label>
              <span>测速 URL</span>
              <input id="autoTestUrl" type="text" value="https://www.gstatic.com/generate_204" />
            </label>
            <label>
              <span>测速间隔 (秒)</span>
              <input id="autoInterval" type="number" value="300" min="1" />
            </label>
            <label>
              <span>容差 (ms)</span>
              <input id="autoTolerance" type="number" value="50" min="0" />
            </label>
          </div>

          <label class="block">
            <span>额外代理组 (JSON 数组，可选)</span>
            <textarea id="extraGroups" rows="6" spellcheck="false" placeholder='[{"name":"媒体","type":"select","proxies":["Proxy","DIRECT"]}]'></textarea>
          </label>
        </section>

        <section class="panel">
          <h3>节点输入</h3>
          <p class="meta">支持 YAML/JSON，支持输入完整配置（会自动取 proxies）。</p>
          <textarea id="nodesInput" rows="14" spellcheck="false"></textarea>
          <div class="actions">
            <button class="btn ghost" id="clearNodesInput">清空节点输入</button>
          </div>
        </section>

        <section class="panel">
          <h3>节点库</h3>
          <p class="meta">在上方转换后会自动加入这里，可勾选需要的节点并预览详情。</p>
          <div class="node-actions">
            <button class="btn ghost" id="selectAllNodes">全选</button>
            <button class="btn ghost" id="clearNodes">清空选择</button>
            <button class="btn primary" id="applySelected">加入节点输入</button>
          </div>
          <div id="nodeList" class="node-list"></div>
          <label class="block">
            <span>节点详情预览</span>
            <textarea id="nodePreview" rows="10" spellcheck="false" readonly></textarea>
          </label>
          <div id="nodeStatus" class="status-lite"></div>
        </section>

        <section class="panel wide">
          <h3>分流规则选择</h3>
          <div class="toolbar">
            <label>
              <span>规则源基地址</span>
              <input id="rawBase" type="text" value="https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/" />
            </label>
            <label>
              <span>GitHub 加速前缀</span>
              <input id="ghPrefix" type="text" value="https://ghfast.top/" />
            </label>
            <label class="inline">
              <input id="applyGhPrefix" type="checkbox" checked />
              <span>启用前缀</span>
            </label>
            <label>
              <span>规则刷新间隔 (秒)</span>
              <input id="ruleInterval" type="number" value="86400" min="1" />
            </label>
          </div>

          <div class="rule-search">
            <label>
              <span>搜索规则</span>
              <input id="ruleSearch" type="text" placeholder="例如：douyin / tiktok / 抖音" />
            </label>
            <button class="btn ghost" id="searchRepo">仓库检索</button>
          </div>

          <div class="rule-actions">
            <button class="btn primary" id="selectAll">全选可选</button>
            <button class="btn ghost" id="clearOptional">清空可选</button>
          </div>

          <div id="ruleGrid" class="rule-grid"></div>

          <div class="repo-panel" id="repoPanel">
            <div class="repo-head">
              <strong>仓库结果</strong>
              <span class="meta" id="repoStatus"></span>
            </div>
            <div id="repoResults" class="repo-results"></div>
          </div>

          <div class="divider"></div>

          <div class="form-grid">
            <label class="inline">
              <input id="addGeoip" type="checkbox" checked disabled />
              <span>固定添加 GEOIP,CN,DIRECT</span>
            </label>
            <label>
              <span>最终兜底策略</span>
              <input id="finalPolicy" type="text" value="Proxy" />
            </label>
          </div>

          <label class="block">
            <span>额外规则 (一行一条，可选)</span>
            <textarea id="extraRules" rows="6" spellcheck="false" placeholder="DOMAIN-SUFFIX,example.com,Proxy"></textarea>
          </label>
        </section>

        <section class="panel output">
          <h3>输出</h3>
          <div class="actions">
            <button class="btn primary" id="generateBtn">生成 YAML</button>
            <button class="btn ghost" id="copyBtn">复制</button>
            <button class="btn ghost" id="downloadBtn">下载</button>
          </div>
          <div id="status" class="status"></div>
          <textarea id="outputYaml" rows="20" spellcheck="false" readonly></textarea>
        </section>
      </div>
    </section>

    <footer class="footer">
      <div>全部处理在浏览器本地完成，不会请求网络上传你的节点信息。</div>
      <div>小提示：先在上方转换节点，再点击“加入分流配置”。</div>
    </footer>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
